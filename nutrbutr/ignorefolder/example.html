<!doctype HTML>
<p><meta charset="utf-8"> <html> <head> <link href="data:text/css,%2F%2A%0Anot%20sure%20original%20author%0Abelieve%20I%20copied%2Fpasted%20from%0Ahttp%3A%2F%2Fwww%2Ed3noob%2Eorg%2F2013%2F02%2Fsankey%2Ddiagrams%2Ddescription%2Dof%2Dd3js%2Dcode%2Ehtml%0Abut%20have%20to%20think%20original%20source%20was%20Mike%20Bostock%0Ahttp%3A%2F%2Fbost%2Eocks%2Eorg%2Fmike%2Fsankey%2F%0A%2A%2F%0A%0A%2Enode%20rect%20%7B%0A%20%20cursor%3A%20move%3B%0A%20%20fill%2Dopacity%3A%20%2E9%3B%0A%20%20shape%2Drendering%3A%20crispEdges%3B%0A%7D%0A%0A%2Enode%20text%20%7B%0A%20%20pointer%2Devents%3A%20none%3B%0A%20%20text%2Dshadow%3A%200%201px%200%20%23fff%3B%0A%7D%0A%0A%2Elink%20%7B%0A%20%20fill%3A%20none%3B%0A%20%20stroke%3A%20%23000%3B%0A%20%20stroke%2Dopacity%3A%20%2E2%3B%0A%7D%0A%0A%2Elink%3Ahover%20%7B%0A%20%20stroke%2Dopacity%3A%20%2E5%3B%0A%7D%0A%0Asvg%20%7B%0A%20%20font%3A%2010px%20sans%2Dserif%3B%0A%7D" rel="stylesheet"></p>
<pre><code>&lt;script src='http://timelyportfolio.github.io/rCharts_d3_sankey/js/d3.v3.js' type='text/javascript'&gt;&lt;/script&gt;
&lt;script src='http://timelyportfolio.github.io/rCharts_d3_sankey/js/sankey.js' type='text/javascript'&gt;&lt;/script&gt;

&lt;style&gt;
.rChart {
  display: block;
  margin-left: auto; 
  margin-right: auto;
  width: 960px;
  height: 500px;
}  
&lt;/style&gt;</code></pre>
<p></head> <body></p>
<pre><code>&lt;div id = 'chartdab95bc77a5d' class = 'rChart rCharts_d3_sankey'&gt;&lt;/div&gt;    
&lt;!--Attribution:</code></pre>
<p>Mike Bostock https://github.com/d3/d3-plugins/tree/master/sankey Mike Bostock http://bost.ocks.org/mike/sankey/ --&gt;</p>
<script>
(function(){
var params = {
 "dom": "chartdab95bc77a5d",
"width":    960,
"height":    500,
"data": {
 "source": [ "75.2013_CLASS", "75.2012_CLASS", "176.2008_CLASS", "75.2011_CLASS", "36.2009_CLASS", "176.2009_CLASS", "36.2008_CLASS", "36.2010_CLASS", "75.2008_CLASS", "36.2011_CLASS", "36.2012_CLASS", "75.2009_CLASS", "75.2010_CLASS", "36.2013_CLASS", "61.2013_CLASS", "61.2012_CLASS", "61.2011_CLASS", "69.2012_CLASS", "176.2010_CLASS", "69.2011_CLASS", "69.2013_CLASS", "204.2011_CLASS", "204.2012_CLASS", "176.2008_CLASS", "176.2008_CLASS", "204.2013_CLASS", "75.2008_CLASS", "176.2013_CLASS", "176.2012_CLASS", "176.2010_CLASS", "24.2008_CLASS", "61.2010_CLASS", "24.2009_CLASS", "176.2008_CLASS", "176.2011_CLASS", "75.2010_CLASS", "24.2009_CLASS", "24.2008_CLASS", "61.2008_CLASS", "24.2009_CLASS", "176.2010_CLASS", "69.2010_CLASS", "36.2009_CLASS", "36.2010_CLASS", "176.2009_CLASS", "24.2013_CLASS", "36.2010_CLASS", "36.2009_CLASS", "36.2010_CLASS", "176.2009_CLASS", "61.2009_CLASS", "61.2008_CLASS", "61.2009_CLASS", "176.2010_CLASS", "24.2008_CLASS", "36.2008_CLASS", "176.2010_CLASS", "176.2009_CLASS", "24.2010_CLASS", "75.2008_CLASS", "176.2010_CLASS", "176.2009_CLASS", "75.2010_CLASS", "24.2012_CLASS", "75.2009_CLASS", "36.2009_CLASS", "69.2008_CLASS", "24.2011_CLASS", "61.2012_CLASS", "75.2013_CLASS", "24.2011_CLASS", "176.2008_CLASS", "204.2012_CLASS", "24.2013_CLASS", "69.2009_CLASS", "24.2011_CLASS", "204.2011_CLASS", "176.2009_CLASS", "61.2009_CLASS", "69.2008_CLASS", "24.2010_CLASS", "36.2008_CLASS", "61.2011_CLASS", "61.2012_CLASS", "36.2010_CLASS", "61.2013_CLASS", "24.2008_CLASS", "24.2009_CLASS", "69.2010_CLASS", "61.2012_CLASS", "69.2013_CLASS", "176.2009_CLASS", "24.2013_CLASS", "24.2012_CLASS", "61.2013_CLASS", "61.2009_CLASS", "204.2010_CLASS", "204.2013_CLASS", "61.2011_CLASS", "176.2010_CLASS", "36.2012_CLASS", "176.2013_CLASS", "36.2013_CLASS", "36.2013_CLASS", "36.2008_CLASS", "75.2009_CLASS", "24.2010_CLASS", "75.2010_CLASS", "36.2011_CLASS", "176.2011_CLASS", "75.2012_CLASS", "36.2009_CLASS", "61.2013_CLASS", "61.2009_CLASS", "69.2009_CLASS", "204.2011_CLASS", "69.2011_CLASS", "176.2013_CLASS", "61.2008_CLASS", "75.2009_CLASS", "75.2013_CLASS", "75.2008_CLASS", "69.2008_CLASS", "24.2009_CLASS", "36.2011_CLASS", "75.2011_CLASS", "61.2011_CLASS", "61.2010_CLASS", "61.2012_CLASS", "69.2013_CLASS", "75.2012_CLASS", "61.2013_CLASS", "69.2011_CLASS", "24.2012_CLASS", "69.2013_CLASS", "69.2008_CLASS", "36.2009_CLASS", "24.2013_CLASS", "75.2009_CLASS", "176.2012_CLASS", "36.2013_CLASS", "36.2008_CLASS", "69.2009_CLASS", "61.2012_CLASS", "69.2012_CLASS", "75.2013_CLASS", "61.2011_CLASS", "61.2011_CLASS", "61.2012_CLASS", "75.2013_CLASS", "75.2009_CLASS", "61.2010_CLASS", "61.2013_CLASS", "75.2011_CLASS", "176.2012_CLASS", "176.2012_CLASS", "36.2012_CLASS", "61.2013_CLASS", "36.2013_CLASS", "204.2010_CLASS", "75.2010_CLASS", "176.2008_CLASS", "69.2010_CLASS", "75.2013_CLASS", "24.2009_CLASS", "204.2008_CLASS", "204.2008_CLASS", "24.2008_CLASS", "75.2010_CLASS", "61.2010_CLASS", "24.2010_CLASS", "61.2010_CLASS", "75.2012_CLASS", "204.2013_CLASS", "61.2008_CLASS", "75.2008_CLASS", "36.2010_CLASS", "61.2010_CLASS", "75.2011_CLASS", "204.2012_CLASS", "69.2011_CLASS", "75.2008_CLASS", "75.2008_CLASS", "204.2008_CLASS", "69.2009_CLASS", "36.2012_CLASS", "69.2011_CLASS", "69.2011_CLASS", "75.2012_CLASS", "176.2012_CLASS", "176.2013_CLASS", "24.2013_CLASS", "24.2011_CLASS", "36.2011_CLASS", "36.2012_CLASS", "176.2012_CLASS", "69.2012_CLASS", "204.2012_CLASS", "176.2011_CLASS", "176.2011_CLASS", "36.2012_CLASS", "24.2008_CLASS", "61.2008_CLASS", "204.2009_CLASS", "75.2011_CLASS", "61.2011_CLASS", "24.2012_CLASS", "36.2008_CLASS", "204.2008_CLASS", "69.2010_CLASS", "69.2010_CLASS", "69.2011_CLASS", "204.2011_CLASS", "204.2012_CLASS", "69.2013_CLASS", "69.2013_CLASS", "204.2013_CLASS", "24.2013_CLASS", "69.2008_CLASS", "204.2009_CLASS", "61.2009_CLASS", "36.2011_CLASS", "75.2011_CLASS", "24.2011_CLASS", "69.2012_CLASS", "69.2012_CLASS", "24.2013_CLASS", "24.2009_CLASS", "36.2010_CLASS", "69.2010_CLASS", "204.2010_CLASS", "24.2010_CLASS", "69.2012_CLASS", "75.2012_CLASS", "36.2012_CLASS", "176.2008_CLASS", "204.2008_CLASS", "69.2009_CLASS", "69.2009_CLASS", "69.2009_CLASS", "24.2010_CLASS", "24.2010_CLASS", "176.2011_CLASS", "36.2011_CLASS", "24.2012_CLASS", "36.2013_CLASS", "176.2013_CLASS", "36.2013_CLASS", "69.2013_CLASS", "176.2013_CLASS", "61.2009_CLASS", "204.2011_CLASS", "176.2011_CLASS", "75.2011_CLASS", "176.2011_CLASS", "24.2011_CLASS", "69.2012_CLASS", "75.2012_CLASS", "36.2008_CLASS", "61.2008_CLASS", "69.2008_CLASS", "204.2008_CLASS", "69.2008_CLASS", "61.2008_CLASS", "204.2009_CLASS", "204.2009_CLASS", "69.2010_CLASS", "75.2010_CLASS", "204.2010_CLASS", "204.2010_CLASS", "204.2010_CLASS", "204.2011_CLASS", "24.2012_CLASS", "176.2012_CLASS", "204.2012_CLASS", "24.2012_CLASS", "204.2013_CLASS" ],
"target": [ "75.2014_CLASS", "75.2013_CLASS", "176.2009_CLASS", "75.2012_CLASS", "36.2010_CLASS", "176.2010_CLASS", "36.2009_CLASS", "36.2011_CLASS", "75.2009_CLASS", "36.2012_CLASS", "36.2013_CLASS", "75.2010_CLASS", "75.2011_CLASS", "36.2014_CLASS", "61.2014_CLASS", "61.2013_CLASS", "61.2012_CLASS", "69.2013_CLASS", "61.2011_CLASS", "69.2012_CLASS", "69.2014_CLASS", "204.2012_CLASS", "204.2013_CLASS", "36.2009_CLASS", "24.2009_CLASS", "204.2014_CLASS", "176.2009_CLASS", "176.2014_CLASS", "176.2013_CLASS", "176.2011_CLASS", "24.2009_CLASS", "61.2011_CLASS", "176.2010_CLASS", "61.2009_CLASS", "176.2012_CLASS", "204.2011_CLASS", "24.2010_CLASS", "36.2009_CLASS", "176.2009_CLASS", "36.2010_CLASS", "24.2011_CLASS", "69.2011_CLASS", "24.2010_CLASS", "24.2011_CLASS", "36.2010_CLASS", "61.2014_CLASS", "75.2011_CLASS", "176.2010_CLASS", "69.2011_CLASS", "61.2010_CLASS", "61.2010_CLASS", "61.2009_CLASS", "176.2010_CLASS", "204.2011_CLASS", "176.2009_CLASS", "24.2009_CLASS", "75.2011_CLASS", "75.2010_CLASS", "24.2011_CLASS", "36.2009_CLASS", "69.2011_CLASS", "69.2010_CLASS", "69.2011_CLASS", "24.2013_CLASS", "36.2010_CLASS", "75.2010_CLASS", "69.2009_CLASS", "24.2012_CLASS", "75.2013_CLASS", "204.2014_CLASS", "36.2012_CLASS", "75.2009_CLASS", "75.2013_CLASS", "24.2014_CLASS", "69.2010_CLASS", "61.2012_CLASS", "75.2012_CLASS", "204.2010_CLASS", "24.2010_CLASS", "176.2009_CLASS", "61.2011_CLASS", "176.2009_CLASS", "176.2012_CLASS", "24.2013_CLASS", "61.2011_CLASS", "75.2014_CLASS", "61.2009_CLASS", "61.2010_CLASS", "75.2011_CLASS", "176.2013_CLASS", "75.2014_CLASS", "24.2010_CLASS", "36.2014_CLASS", "61.2013_CLASS", "176.2014_CLASS", "36.2010_CLASS", "75.2011_CLASS", "75.2014_CLASS", "24.2012_CLASS", "36.2011_CLASS", "24.2013_CLASS", "61.2014_CLASS", "24.2014_CLASS", "61.2014_CLASS", "75.2009_CLASS", "176.2010_CLASS", "36.2011_CLASS", "61.2011_CLASS", "24.2012_CLASS", "61.2012_CLASS", "69.2013_CLASS", "69.2010_CLASS", "24.2014_CLASS", "75.2010_CLASS", "75.2010_CLASS", "61.2012_CLASS", "75.2012_CLASS", "69.2014_CLASS", "24.2009_CLASS", "69.2010_CLASS", "61.2014_CLASS", "69.2009_CLASS", "75.2009_CLASS", "75.2010_CLASS", "61.2012_CLASS", "61.2012_CLASS", "75.2012_CLASS", "24.2011_CLASS", "204.2013_CLASS", "36.2014_CLASS", "204.2013_CLASS", "36.2014_CLASS", "61.2012_CLASS", "36.2013_CLASS", "176.2014_CLASS", "36.2009_CLASS", "61.2010_CLASS", "176.2014_CLASS", "61.2010_CLASS", "75.2013_CLASS", "75.2014_CLASS", "61.2009_CLASS", "36.2010_CLASS", "69.2013_CLASS", "75.2013_CLASS", "69.2014_CLASS", "204.2012_CLASS", "36.2012_CLASS", "36.2013_CLASS", "176.2014_CLASS", "24.2010_CLASS", "204.2011_CLASS", "69.2014_CLASS", "69.2012_CLASS", "24.2013_CLASS", "61.2013_CLASS", "75.2013_CLASS", "204.2014_CLASS", "69.2014_CLASS", "204.2011_CLASS", "36.2011_CLASS", "69.2009_CLASS", "61.2011_CLASS", "36.2014_CLASS", "69.2010_CLASS", "176.2009_CLASS", "36.2009_CLASS", "75.2009_CLASS", "24.2011_CLASS", "36.2011_CLASS", "75.2011_CLASS", "75.2011_CLASS", "61.2013_CLASS", "61.2014_CLASS", "36.2009_CLASS", "61.2009_CLASS", "204.2011_CLASS", "69.2011_CLASS", "204.2012_CLASS", "69.2013_CLASS", "176.2012_CLASS", "204.2009_CLASS", "24.2009_CLASS", "69.2009_CLASS", "176.2010_CLASS", "204.2013_CLASS", "204.2012_CLASS", "24.2012_CLASS", "176.2013_CLASS", "69.2013_CLASS", "75.2014_CLASS", "75.2014_CLASS", "176.2012_CLASS", "75.2012_CLASS", "176.2013_CLASS", "36.2013_CLASS", "36.2013_CLASS", "61.2013_CLASS", "69.2012_CLASS", "75.2012_CLASS", "61.2013_CLASS", "69.2009_CLASS", "75.2009_CLASS", "75.2010_CLASS", "176.2012_CLASS", "69.2012_CLASS", "75.2013_CLASS", "69.2009_CLASS", "75.2009_CLASS", "204.2011_CLASS", "24.2011_CLASS", "36.2012_CLASS", "69.2012_CLASS", "176.2013_CLASS", "24.2014_CLASS", "61.2014_CLASS", "69.2014_CLASS", "69.2014_CLASS", "24.2009_CLASS", "36.2010_CLASS", "69.2010_CLASS", "176.2012_CLASS", "36.2012_CLASS", "69.2012_CLASS", "176.2013_CLASS", "61.2013_CLASS", "204.2014_CLASS", "204.2010_CLASS", "176.2011_CLASS", "36.2011_CLASS", "69.2011_CLASS", "69.2011_CLASS", "24.2013_CLASS", "24.2013_CLASS", "69.2013_CLASS", "204.2009_CLASS", "24.2009_CLASS", "204.2010_CLASS", "24.2010_CLASS", "61.2010_CLASS", "176.2011_CLASS", "204.2011_CLASS", "204.2012_CLASS", "69.2012_CLASS", "204.2013_CLASS", "176.2014_CLASS", "204.2014_CLASS", "204.2014_CLASS", "204.2014_CLASS", "36.2014_CLASS", "204.2010_CLASS", "176.2012_CLASS", "24.2012_CLASS", "24.2012_CLASS", "36.2012_CLASS", "75.2012_CLASS", "204.2013_CLASS", "36.2013_CLASS", "204.2009_CLASS", "204.2009_CLASS", "204.2009_CLASS", "61.2009_CLASS", "61.2009_CLASS", "69.2009_CLASS", "176.2010_CLASS", "24.2010_CLASS", "176.2011_CLASS", "176.2011_CLASS", "24.2011_CLASS", "36.2011_CLASS", "61.2011_CLASS", "36.2012_CLASS", "176.2013_CLASS", "204.2013_CLASS", "24.2013_CLASS", "69.2013_CLASS", "176.2014_CLASS" ],
"value": [ 1301, 1284, 1244, 1204, 1114, 1087, 1036, 879, 814, 801, 801, 745, 729, 675, 530, 517, 507, 461, 442, 441, 388, 292, 277, 274, 262, 245, 236, 220, 216, 200, 174, 159, 155, 151, 151, 147, 143, 140, 132, 132, 130, 127, 119, 119, 117, 115, 113, 111, 109, 107, 106, 105, 104, 104, 103, 103, 103, 100, 95, 92, 92, 87, 84, 84, 83, 82, 78, 77, 76, 74, 72, 67, 67, 66, 64, 64, 63, 62, 62, 59, 59, 57, 57, 57, 55, 55, 53, 53, 53, 52, 52, 51, 51, 50, 50, 49, 48, 47, 45, 43, 40, 39, 38, 38, 36, 36, 36, 36, 35, 35, 35, 34, 34, 33, 31, 31, 31, 31, 30, 30, 30, 29, 29, 29, 29, 29, 29, 28, 28, 28, 27, 27, 26, 26, 25, 24, 24, 24, 23, 23, 23, 22, 21, 21, 21, 21, 20, 20, 20, 20, 19, 19, 19, 18, 18, 18, 18, 18, 18, 17, 17, 16, 16, 16, 15, 14, 14, 14, 14, 14, 14, 14, 14, 14, 13, 13, 13, 13, 13, 13, 12, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10, 10, 9, 9, 9, 9, 9, 9, 8, 8, 8, 7, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ] 
},
"nodeWidth":     15,
"nodePadding":     10,
"layout":     32,
"id": "chartdab95bc77a5d" 
};

params.units ? units = " " + params.units : units = "";

//hard code these now but eventually make available
var formatNumber = d3.format("0,.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + units; },
    color = d3.scale.category20();

if(params.labelFormat){
  formatNumber = d3.format(".2%");
}

var svg = d3.select('#' + params.id).append("svg")
    .attr("width", params.width)
    .attr("height", params.height);
    
var sankey = d3.sankey()
    .nodeWidth(params.nodeWidth)
    .nodePadding(params.nodePadding)
    .layout(params.layout)
    .size([params.width,params.height]);
    
var path = sankey.link();
    
var data = params.data,
    links = [],
    nodes = [];
    
//get all source and target into nodes
//will reduce to unique in the next step
//also get links in object form
data.source.forEach(function (d, i) {
    nodes.push({ "name": data.source[i] });
    nodes.push({ "name": data.target[i] });
    links.push({ "source": data.source[i], "target": data.target[i], "value": +data.value[i] });
}); 

//now get nodes based on links data
//thanks Mike Bostock https://groups.google.com/d/msg/d3-js/pl297cFtIQk/Eso4q_eBu1IJ
//this handy little function returns only the distinct / unique nodes
nodes = d3.keys(d3.nest()
                .key(function (d) { return d.name; })
                .map(nodes));

//it appears d3 with force layout wants a numeric source and target
//so loop through each link replacing the text with its index from node
links.forEach(function (d, i) {
    links[i].source = nodes.indexOf(links[i].source);
    links[i].target = nodes.indexOf(links[i].target);
});

//now loop through each nodes to make nodes an array of objects rather than an array of strings
nodes.forEach(function (d, i) {
    nodes[i] = { "name": d };
});

sankey
  .nodes(nodes)
  .links(links)
  .layout(params.layout);
  
var link = svg.append("g").selectAll(".link")
  .data(links)
.enter().append("path")
  .attr("class", "link")
  .attr("d", path)
  .style("stroke-width", function (d) { return Math.max(1, d.dy); })
  .sort(function (a, b) { return b.dy - a.dy; });

link.append("title")
  .text(function (d) { return d.source.name + " â†’ " + d.target.name + "\n" + format(d.value); });

var node = svg.append("g").selectAll(".node")
  .data(nodes)
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; })
.call(d3.behavior.drag()
  .origin(function (d) { return d; })
  .on("dragstart", function () { this.parentNode.appendChild(this); })
  .on("drag", dragmove));

node.append("rect")
  .attr("height", function (d) { return d.dy; })
  .attr("width", sankey.nodeWidth())
  .style("fill", function (d) { return d.color = color(d.name.replace(/ .*/, "")); })
  .style("stroke", function (d) { return d3.rgb(d.color).darker(2); })
.append("title")
  .text(function (d) { return d.name + "\n" + format(d.value); });

node.append("text")
  .attr("x", -6)
  .attr("y", function (d) { return d.dy / 2; })
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .attr("transform", null)
  .text(function (d) { return d.name; })
.filter(function (d) { return d.x < params.width / 2; })
  .attr("x", 6 + sankey.nodeWidth())
  .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
                   d.x = Math.max(0, Math.min(params.width - d.dx, d3.event.x))
                ) + "," + (
                   d.y = Math.max(0, Math.min(params.height - d.dy, d3.event.y))
                ) + ")");
        sankey.relayout();
        link.attr("d", path);
  }
})();
</script>
<pre><code>  &lt;script&gt;
  // to be specific in case you have more than one chart
  d3.selectAll('#chartdab95bc77a5d svg path.link')
  .style('stroke', function(d){
  //here we will use the source color
  //if you want target then sub target for source
  //or if you want something other than gray
  //supply a constant
  //or use a categorical scale or gradient
  return d.source.color;
  })
  //note no changes were made to opacity
  //to do uncomment below but will affect mouseover
  //so will need to define mouseover and mouseout
  //happy to show how to do this also
  // .style('stroke-opacity', .7) 
  &lt;/script&gt;
      </code></pre>
<p></body> </html></p>
